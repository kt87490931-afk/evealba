<?php
/**
 * Gemini API 설정 (이브알바 AI 소개글 생성)
 * 보안: API 키는 환경변수 GEMINI_API_KEY 로 우선 사용 가능
 */
if (!defined('_GNUBOARD_')) exit;

// API 키: 1) 환경변수 GEMINI_API_KEY (getenv 또는 $_SERVER), 2) extend/gemini_api_key.env 파일
// 새 키 발급: https://aistudio.google.com/apikey
$gemini_api_key = trim((string) (getenv('GEMINI_API_KEY') ?: ($_SERVER['GEMINI_API_KEY'] ?? '')));
if ($gemini_api_key === '') {
    $ext_dir = defined('G5_EXTEND_PATH') ? rtrim(G5_EXTEND_PATH, '/') : (defined('G5_PATH') ? G5_PATH . '/extend' : __DIR__);
    $key_file = $ext_dir . '/gemini_api_key.env';
    if (file_exists($key_file) && is_readable($key_file)) {
        $gemini_api_key = trim((string) file_get_contents($key_file));
    } else {
        $gemini_api_key = '';
    }
}
$gemini_model = 'gemini-2.5-flash';

// AI 생성 파라미터: 창의성 극대화
$gemini_temperature = 0.95;
$gemini_top_p = 0.9;

// 랜덤 스타일 시드: 매 호출마다 다른 스타일 지시를 주입하여 콘텐츠 차별화
$gemini_style_seeds = [
    '이번 글은 따뜻한 봄날의 느낌으로, 새 출발의 설렘을 담아서 작성해줘.',
    '이번 글은 활기찬 여름의 에너지로, 자신감 넘치는 톤으로 작성해줘.',
    '이번 글은 감성적인 가을 감성으로, 차분하면서도 진심이 느껴지게 작성해줘.',
    '이번 글은 포근한 겨울 카페의 분위기로, 따뜻하고 아늑한 느낌으로 작성해줘.',
    '이번 글은 친구에게 좋은 일자리를 소개하는 것처럼, 신나고 추천하는 톤으로 작성해줘.',
    '이번 글은 선배가 후배에게 조언하듯, 경험에서 우러나는 진정성 있는 톤으로 작성해줘.',
    '이번 글은 밝은 아침 햇살처럼, 희망적이고 긍정적인 에너지를 가득 담아 작성해줘.',
    '이번 글은 편안한 대화를 나누듯, 자연스럽고 솔직한 톤으로 작성해줘.',
    '이번 글은 SNS 인플루언서처럼 트렌디하고 세련된 느낌으로 작성해줘.',
    '이번 글은 동네 이웃처럼 소박하고 진솔한 느낌으로 작성해줘.',
    '이번 글은 응원하는 코치처럼, 동기부여가 되는 파이팅 넘치는 톤으로 작성해줘.',
    '이번 글은 프리미엄 매거진 에디터처럼, 세련되고 고급스러운 톤으로 작성해줘.',
];

if (!function_exists('gemini_get_random_style_seed')) {
    function gemini_get_random_style_seed() {
        global $gemini_style_seeds;
        return $gemini_style_seeds[array_rand($gemini_style_seeds)];
    }
}

// 톤별 역할: jobs_register_main 선택값 → jr_data.ai_tone → jobs_ai_queue_process → gemini_api.lib
// 고정(원본 그대로): 기본정보, 업소이미지, 편의사항, 키워드, MBTI → Gemini 참고만
// Gemini 생성: intro, card(4장), location, env, welfare, qualify, extra, mbti_comment
$gemini_section_instruction = "[광고 페이지 섹션별 작성 지시]\n"
    . "아래 14개 키를 가진 JSON으로만 응답하세요. 설명 없이 JSON만 반환하세요.\n"
    . "각 섹션은 [작성할 데이터]를 바탕으로 작성하되, [고정 참고 데이터]의 내용(닉네임, 연락처, 지역명, 급여 등)은 참고만 하고 그대로 반복하지 마세요.\n\n"
    . "[차별화 규칙 - 반드시 준수]\n"
    . "1. intro(인사말)는 매번 완전히 다른 첫 문장으로 시작하세요. '안녕하세요', '반갑습니다' 같은 정형화된 시작은 금지입니다.\n"
    . "2. 업소의 고유한 특징(업종, 지역, 분위기)을 살려 그 업소만의 이야기를 담으세요.\n"
    . "3. 같은 표현이나 문장 구조를 반복하지 마세요. 매번 새로운 비유, 표현, 문장 패턴을 사용하세요.\n"
    . "4. 카드 제목(card*_title)은 창의적이고 눈에 띄는 표현을 사용하세요. 뻔한 제목은 금지입니다.\n"
    . "5. 이모지는 4바이트 유니코드 이모지(🌸💎✨🎀💕🌟🔥💫🌈🎉👑💖🍀🦋💝🌺🎶)를 적극 사용하세요.\n"
    . "6. 각 섹션마다 최소 3개 이상의 이모지를 넣으세요.\n"
    . "7. 업종 특성에 맞는 전문적이면서도 매력적인 표현을 사용하세요.\n\n"
    . "{\n"
    . "  \"intro\": \"인사말 (3~5문장, 구직자를 환영하는 따뜻한 첫인사. 정형화된 인사 금지, 창의적 시작)\",\n"
    . "  \"card1_title\": \"포인트카드1 제목 (10자 이내, 위치/교통 관련, 창의적 표현)\",\n"
    . "  \"card1_desc\": \"포인트카드1 설명 (2~3문장, 위치 장점, 구체적 묘사)\",\n"
    . "  \"card2_title\": \"포인트카드2 제목 (10자 이내, 시설/환경 관련, 창의적 표현)\",\n"
    . "  \"card2_desc\": \"포인트카드2 설명 (2~3문장, 시설 장점, 감성적 묘사)\",\n"
    . "  \"card3_title\": \"포인트카드3 제목 (10자 이내, 급여/혜택 관련, 매력적 표현)\",\n"
    . "  \"card3_desc\": \"포인트카드3 설명 (2~3문장, 급여 장점, 현실적 장점 강조)\",\n"
    . "  \"card4_title\": \"포인트카드4 제목 (10자 이내, 분위기/환영 관련, 따뜻한 표현)\",\n"
    . "  \"card4_desc\": \"포인트카드4 설명 (2~3문장, 분위기 장점, 생동감 있는 묘사)\",\n"
    . "  \"location\": \"업소 위치 상세 소개 (4~6문장, 교통·주변 환경 중심)\",\n"
    . "  \"env\": \"근무환경 상세 소개 (4~6문장, 실제 근무 모습을 그리듯)\",\n"
    . "  \"welfare\": \"지원 혜택 및 복리후생 (4~6문장, 구직자 관점의 매력 포인트)\",\n"
    . "  \"qualify\": \"지원 자격 및 우대사항 (3~5문장, 부담 없이 지원 가능하다는 뉘앙스)\",\n"
    . "  \"extra\": \"추가 상세설명/약속 (3~5줄, 각 줄 앞에 ✔️ 붙여서, 진심 어린 약속)\",\n"
    . "  \"mbti_comment\": \"선호 MBTI 관련 한마디 (2~3문장, 해당 MBTI의 매력과 업소 궁합)\"\n"
    . "}\n";

$gemini_roles = [
    'unnie' => [
        'name' => '친근한 언니 톤',
        'prompt' => "너는 20~30대 여성 구직자들에게 친근하게 말하는 다정한 언니 사장님이야.\n\n"
            . "[중요] [고정 참고 데이터]는 화면에 그대로 표시되므로 참고만 하고, 생성 글에 포함하지 마라.\n"
            . "[작성할 데이터]를 바탕으로 AI소개글 종합정리 순서대로, 총 1,500자 내외의 업소소개글을 작성해줘.\n"
            . "말투: ~해요, ~답니다 등 해요체. 부드럽고 편안한 언니 느낌.\n"
            . "특징: 4바이트 이모지(🌸🌷🎀💖✨🧸🍬🍭)를 각 단락마다 3개 이상 사용하여 화사하게 꾸밀 것.\n"
            . "특징: 가독성 좋게 단락을 나누고, 문장 사이에 따뜻한 응원 멘트를 섞어줘.\n\n"
    ],
    'boss_male' => [
        'name' => '세심한 남사장님 톤',
        'prompt' => "너는 여성 구직자들에게 세심하고 다정하게 말하는 남성 사장님이야.\n\n"
            . "[중요] [고정 참고 데이터]는 화면에 그대로 표시되므로 참고만 하고, 생성 글에 포함하지 마라.\n"
            . "[작성할 데이터]를 바탕으로 AI소개글 종합정리 순서대로, 총 1,500자 내외의 업소소개글을 작성해줘.\n"
            . "말투: 정중하고 다정한 ~합니다 체. 배려심 있고 믿음직한 느낌.\n"
            . "특징: 4바이트 이모지(☕🍀🤝⭐🌿🏠🛡️✅)를 각 단락마다 2~3개 사용하여 신뢰감을 줄 것.\n"
            . "특징: 가독성 좋게 단락을 나누고, 근무 환경의 안전함과 세심한 배려를 강조해줘.\n\n"
    ],
    'pro' => [
        'name' => '전문가 톤',
        'prompt' => "너는 구인광고 전문 카피라이터야.\n\n"
            . "[중요] [고정 참고 데이터]는 화면에 그대로 표시되므로 참고만 하고, 생성 글에 포함하지 마라.\n"
            . "[작성할 데이터]를 바탕으로 AI소개글 종합정리 순서대로, 총 1,500자 내외의 업소소개글을 작성해줘.\n"
            . "말투: 간결하고 전문적인 문체. 핵심 정보를 명확히 전달.\n"
            . "특징: 4바이트 이모지(💎📊📈📋✨📌💰💎)를 중요 포인트마다 사용하여 가독성을 극대화할 것.\n"
            . "특징: 가독성 좋게 단락을 나누고, 불필요한 수식어보다는 팩트와 혜택 위주로 구성해줘.\n\n"
    ],
    'tough_unnie' => [
        'name' => '화끈한 왕언니 톤',
        'prompt' => "너는 업계에서 잔뼈가 굵은, 화끈하고 시원시원한 왕언니 사장님이야.\n\n"
            . "[중요] [고정 참고 데이터]는 화면에 그대로 표시되므로 참고만 하고, 생성 글에 포함하지 마라.\n"
            . "[작성할 데이터]를 바탕으로 AI소개글 종합정리 순서대로, 총 1,500자 내외의 업소소개글을 작성해줘.\n"
            . "말투: ~해라, ~와라 등 강단 있는 반말과 존댓말을 섞은 화끈한 말투.\n"
            . "특징: '의리', '돈', '확실한 지원'을 강조하며 불꽃 이모지(🔥)를 적극 활용.\n"
            . "특징: 4바이트 이모지(🔥💰👊💪✨💪🔥💰)를 적극 활용 (각 단락마다 2~3개 이상). 가독성 좋게 단락 나누기.\n\n"
    ],
    'idol_style' => [
        'name' => '화사한 아이돌 톤',
        'prompt' => "너는 밝고 긍정적인 에너지가 넘치는 아이돌 연습생들의 맏언니 같은 사장님이야.\n\n"
            . "[중요] [고정 참고 데이터]는 화면에 그대로 표시되므로 참고만 하고, 생성 글에 포함하지 마라.\n"
            . "[작성할 데이터]를 바탕으로 AI소개글 종합정리 순서대로, 총 1,500자 내외의 업소소개글을 작성해줘.\n"
            . "말투: ~해요!, ~예요! 등 아주 밝고 애교 섞인 비타민 같은 말투.\n"
            . "특징: '꽃길', '함께', '설렘'을 강조하며 하트와 반짝이 이모지를 도배 수준으로 사용.\n"
            . "특징: 4바이트 이모지(💖✨🌸🎀🍭🍬🌈⭐)를 적극 활용 (각 단락마다 3개 이상). 가독성 좋게 단락 나누기.\n\n"
    ],
    'partner_pro' => [
        'name' => '듬직한 파트너 톤',
        'prompt' => "너는 지원자를 단순 직원이 아닌, 비즈니스 파트너로 예우하는 전문 경영인이야.\n\n"
            . "[중요] [고정 참고 데이터]는 화면에 그대로 표시되므로 참고만 하고, 생성 글에 포함하지 마라.\n"
            . "[작성할 데이터]를 바탕으로 AI소개글 종합정리 순서대로, 총 1,500자 내외의 업소소개글을 작성해줘.\n"
            . "말투: ~합니다, ~하십시오 등 격식 있고 신뢰감 넘치는 비즈니스 문체.\n"
            . "특징: '프라이버시', '최고의 대우', '수익 보장'을 논리적으로 설명.\n"
            . "특징: 4바이트 이모지(🤝💼💎🛡️📈✅💰🔒)를 적극 활용 (각 단락마다 2개 이상). 가독성 좋게 단락 나누기.\n\n"
    ],
];

$gemini_closing = [
    'unnie' => [
        'title' => '💌 지금 바로 연락주세요! 기다리고 있을게요~',
        'sub'   => '자다가 깨서 연락 주셔도 괜찮아요! 🌙 24시간 열려 있어요',
    ],
    'boss_male' => [
        'title' => '🤝 편하게 문의 주십시오. 정성껏 안내드리겠습니다.',
        'sub'   => '언제든 부담 없이 연락 주세요. ☕ 친절한 상담을 약속드립니다.',
    ],
    'pro' => [
        'title' => '📋 지원 상담 및 문의 접수',
        'sub'   => '아래 채널로 연락 주시면 빠르게 안내드립니다. 💎',
    ],
    'tough_unnie' => [
        'title' => '🔥 고민은 쓸데없어! 바로 연락해!',
        'sub'   => '늦은 밤이든 새벽이든 상관없어 💪 언제든 연락 와라!',
    ],
    'idol_style' => [
        'title' => '🌸 지금 바로 연락 주세요~! 두근두근 기다리고 있어요! 💖',
        'sub'   => '밤이든 새벽이든 언제든 환영이에요~! ✨ 꽃길만 걸어요!',
    ],
    'partner_pro' => [
        'title' => '💼 상담 문의를 환영합니다.',
        'sub'   => '비즈니스 파트너로서 최선의 조건을 제안드리겠습니다. 🛡️',
    ],
];
